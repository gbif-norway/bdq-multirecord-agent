options:
  logging: CLOUD_LOGGING_ONLY   # or your bucket option

steps:
- name: gcr.io/cloud-builders/docker
  args: ['build',
         '-t','gcr.io/${PROJECT_ID}/github.com/gbif-norway/bdq-multirecord-agent:${COMMIT_SHA}',
         '.']

- name: gcr.io/cloud-builders/docker
  args: ['push',
         'gcr.io/${PROJECT_ID}/github.com/gbif-norway/bdq-multirecord-agent:${COMMIT_SHA}']

- name: gcr.io/google.com/cloudsdktool/cloud-sdk
  entrypoint: gcloud
  args: ['run','deploy','bdq-multirecord-agent',
         '--image','gcr.io/${PROJECT_ID}/github.com/gbif-norway/bdq-multirecord-agent:${COMMIT_SHA}',
         '--region','europe-west1',
         '--allow-unauthenticated']

images:
- 'gcr.io/${PROJECT_ID}/github.com/gbif-norway/bdq-multirecord-agent:${COMMIT_SHA}'
